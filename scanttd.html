<!DOCTYPE html>
<html data-bs-theme="dark">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>replit</title>
  <meta property="og:title" content="Krisnaa Prihadiyanto, S.Kom" />
  <meta property="og:description" content="Silahkan Klik Untuk Membaca Lebih Lengkap Tentang Saya" />
  <meta property="og:url" content="https://webpers.koleksiprihadi.repl.co/" />
  <meta property="og:site_name" content="koleksiprihadi" />
  <meta property="og:image" content="https://koleksiprihadi.github.io/images/koleksiprihadi.jpeg" />
  <meta property="og:image:width" content="288" />
  <meta property="og:image:height" content="288" />
  <meta property="og:image:type" content="image/jpeg" />
  <link href="https://koleksiprihadi.github.io/css/bs/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"
    integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <link href="https://koleksiprihadi.github.io/css/style.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/1.2.4/html5-qrcode.min.js"
    type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/ua-parser-js@0/dist/ua-parser.min.js"></script>
  <script src="https://www.google.com/recaptcha/api.js?render=6Leh6aUoAAAAAF4tnixnJGum8f6WCzMgpu-CBNge"></script>
  <style>
    .drop-zone {
      /* max-width: 200px; */
      height: 200px;
      padding: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-family: "Quicksand", sans-serif;
      font-weight: 500;
      font-size: 20px;
      cursor: pointer;
      color: #cccccc;
      border: 4px dashed #3ba8d4;
      border-radius: 10px;
      margin-top: 10px;
    }

    .drop-zone--over {
      border-style: solid;
    }

    .drop-zone__input {
      display: none;
    }

    .drop-zone__thumb {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      overflow: hidden;
      background-color: #cccccc;
      background-size: cover;
      position: relative;
    }

    .drop-zone__thumb::after {
      content: attr(data-label);
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 5px 0;
      color: #ffffff;
      background: rgba(0, 0, 0, 0.75);
      font-size: 14px;
      text-align: center;
    }

    .scan-area {
      width: auto;
      text-align: center;
    }

    #reader {
      /* padding: 25px; */
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-family: "Quicksand", sans-serif;
      font-weight: 500;
      font-size: 20px;
      cursor: pointer;
      color: #cccccc;
      border: 4px dashed #3ba8d4;
      border-radius: 10px;
      z-index: 1;
    }

    select {
      width: 100%;
      height: 50px;
      color: #a6a6a6;
      border: 1px solid #dcdce6;
      border-radius: 8px;
      padding: 0 24px;
    }

    .hide {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- Start Navbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top nav-pills">
    <div class="container container-fluid">
      <a class="navbar-brand">Krisna Prihadiyanto</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse flex-grow-1 text-right" id="navbarNavAltMarkup">
        <div class="navbar-nav ms-auto flex-nowrap">
          <a class="nav-link" href="/#home">Home</a>
          <a class="nav-link" href="/#about">About Me</a>
          <a class="nav-link" href="/#portofolio">Portofolio</a>
          <a class="nav-link" href="/#article">Article</a>
          <a class="nav-link" href="/#contact">Contact</a>
          <div class="d-flex">
            <a href="/#sendemail" class="btn btn-outline-primary btn-nav px-btn d-none d-lg-inline-flex">Contact Me</a>
          </div>
        </div>
      </div>

  </nav>
  <!-- End Navbar -->

  <!-- Start Content -->
  <main>
    <!-- Start Scan QR -->
    <div class="container container-fluid">
      <div class="text-center text-body-secondary m-4">
        <h3 class="badge">Verifikasi</h3>
        <h1>
          <span class="text-light">Verifikasi</span>
          <span class="text-primary">Tanda Tangan</span>
        </h1>
      </div>
      <!-- Start Qr -->

      <div id="withoutid">
        <h3 class="text-center">Scan Qr Code untuk verifikasi keaslian tanda tangan</h3>
        <div id="camera" class="drop-zone" onclick="openScanner()">
          <span class="drop-zone__prompt"><i class="bi bi-qr-code-scan"></i><br>Click to active camera</span>
        </div>
        <div id="reader" class="hide"></div>
      </div>

      <div id="dttd" class="hide">
        <h1 class="text-center text-primary" id="ttdverif"></h1>
        <div class="mb-3">
          <label for="dokumen" class="form-label">Dokumen</label>
          <input type="text" class="form-control" id="dokumen" readonly>
        </div>
        <div class="mb-3">
          <label for="signby" class="form-label">Ditanda tangani oleh</label>
          <input type="text" class="form-control" id="signby" readonly>
        </div>
        <div class="mb-3">
          <label for="untuk" class="form-label">Ditujukan kepada</label>
          <input type="text" class="form-control" id="untuk" readonly>
        </div>
      </div>
      <!-- End Qr -->
    </div>
    <!-- End Scan QR -->

    <!-- Start Upload Image -->
    <div class="sekolah">
      <div class="text-center text-body-secondary m-4">
        <h3 class="badge">Upload File</h3>
        <h1>
          <span class="text-light">Cek Keaslian</span>
          <span class="text-primary">Dokumen</span>
        </h1>
        Upload file untuk mengecek keaslian dokumen
      </div>
      <div class="container p-4">
        <div id="dropzone" class="drop-zone">
          <span class="drop-zone__prompt">Klik untuk upload file yang akan diperiksa keasliannya<br>Jenis file :
            pdf</span>
          <input type="file" id="file" name="myFile" onchange="onMyfileChange(this)" class="drop-zone__input">
        </div>
      </div>
    </div>
    <!-- End Upload Image -->
  </main>
  <!-- End Content -->

  <footer class="text-center text-body-secondary border-top footer">
    <p>
      <span class="md:inline">·</span> Made with ❤️<span class="md:inline">·</span>
    </p>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/jotted@latest/jotted.min.js"></script>
  <script src="https://unpkg.com/typeit@8.7.1/dist/index.umd.js"></script>
  <script src="https://koleksiprihadi.github.io/js/bs/bootstrap.min.js"></script>
  <!-- <script src="https://koleksiprihadi.github.io/js/script.js"></script> -->
  <script>
    var queryString = window.location.search;
    var urlParams = new URLSearchParams(queryString);
    var cekid = urlParams.get('id');
    var url = "https://script.google.com/macros/s/AKfycbz1_aS2Mh4icTCgWMFGAl179F_0TbO_x8aWjz9LHXQHb873Kyiacd0qMOGAhLxAq6_b/exec";

    if (cekid != null) {
      if (isvalidURL(cekid)) {
        cekid = cekid.replace("https://koleksiprihadi.github.io/digital-signature/?id=", "");
        cekid = cekid.replace("koleksiprihadi.github.io/digital-signature/?id=", "");
      }
      $("div#withoutid").hide();
      $("div#dttd").removeClass("hide");
      cekttd(cekid, token = "")
    }
    $(document).ready(function () {
      alertvisitor();
      $('nav').removeClass('navbar-down').addClass('navbar-up');
    });
    $(window).scroll(function () {
      if ($("html").scrollTop() === 0) {
        $('nav').removeClass('navbar-down').addClass('navbar-up');
      } else {
        $('nav').removeClass('navbar-up').addClass('navbar-down');
      }
    });
    // --------------- Scan Qr -------------------
    var idCam = 0;
    if (window.matchMedia("(max-width: 767px)").matches) {
      var idCam = 1;
    } else {
      var idCam = 0;
    }
    // Creating a reusable QR Code Module in Node Js
    var cameraId = ""
    // Actual Code
    const html5QrCode = new Html5Qrcode("reader");

    function openScanner() {
      $("div#camera").hide()
      $("div#reader").removeClass("hide");
      Html5Qrcode.getCameras().then(devices => {
        /**
         * devices would be an array of objects of type:
         * { id: "id", label: "label" }
         */
        var cameraId = devices[idCam].id
        html5QrCode.start(
          cameraId,
          {
            fps: 10,
            qrbox: 250
          },
          qrCodeMessage => {
            // do something when code is read. For example:Nomoraaa
            qrCodeMessage = qrCodeMessage.replace("https://koleksiprihadi.github.io/digital-signature/?id=", "");
            qrCodeMessage = qrCodeMessage.replace("koleksiprihadi.github.io/digital-signature/?id=", "");
            cekttd(qrCodeMessage, token = "")

            closeScanner()
          },
          errorMessage => {
            // parse error, ideally ignore it. For example:
            console.log(`QR Code no longer in front of camera.`);
          })
          .catch(err => {
            // Opening the scanner failed.
          });

      }).catch(err => {
        // handle err
      });
    }
    function closeScanner() {
      html5QrCode.stop().then(ignore => {
        $("div#camera").show()
        $("div#reader").addClass("hide");
      }).catch(err => {
      });
    }

    function restartScanner() {
      closeScanner();
      openScanner();
    }

    // --------------- Upload file ---------------

    document.querySelectorAll(".drop-zone__input").forEach((inputElement) => {
      const dropZoneElement = inputElement.closest(".drop-zone");

      dropZoneElement.addEventListener("click", (e) => {
        inputElement.click();
      });

      inputElement.addEventListener("change", (e) => {

        if (inputElement.files.length) {
          updateThumbnail(dropZoneElement, inputElement.files[0]);

        }
      });

      dropZoneElement.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZoneElement.classList.add("drop-zone--over");
      });

      ["dragleave", "dragend"].forEach((type) => {
        dropZoneElement.addEventListener(type, (e) => {
          dropZoneElement.classList.remove("drop-zone--over");
        });
      });

      dropZoneElement.addEventListener("drop", (e) => {
        e.preventDefault();

        if (e.dataTransfer.files.length) {
          inputElement.files = e.dataTransfer.files;
          updateThumbnail(dropZoneElement, e.dataTransfer.files[0]);
          onMyfileChange(e.dataTransfer.files[0])
        }

        dropZoneElement.classList.remove("drop-zone--over");
      });
    });

    /**
     * Updates the thumbnail on a drop zone element.
     *
     * @param {HTMLElement} dropZoneElement
              * @param {File} file
              */
    function updateThumbnail(dropZoneElement, file) {
      let thumbnailElement = dropZoneElement.querySelector(".drop-zone__thumb");

      // First time - remove the prompt
      if (dropZoneElement.querySelector(".drop-zone__prompt")) {
        // dropZoneElement.querySelector(".drop-zone__prompt").remove();
        $(".drop-zone__prompt").hide()
      }

      // First time - there is no thumbnail element, so lets create it
      if (!thumbnailElement) {
        thumbnailElement = document.createElement("div");
        thumbnailElement.classList.add("drop-zone__thumb");
        dropZoneElement.appendChild(thumbnailElement);
      }

      thumbnailElement.dataset.label = file.name;

      // Show thumbnail for image files
      if (file.type.startsWith("image/")) {
        const reader = new FileReader();

        reader.readAsDataURL(file);
        reader.onload = () => {
          thumbnailElement.style.backgroundImage = `url('${reader.result}')`;
        };
      } else {
        thumbnailElement.style.backgroundImage = null;
      }
    }

    // --------------- Cek Credential ---------------

    function onMyfileChange(fileInput) {
      console.log(fileInput)
      if (fileInput.files[0] == undefined) {
        return;
      }
      var filename = fileInput.files[0].name;
      // var filesize = fileInput.files[0].size;
      var reader = new FileReader();
      reader.onload = function (ev) {
        // 
        crypto.subtle.digest('SHA-256', ev.target.result).then(hashBuffer => {
          // Convert hex to hash, see https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest#converting_a_digest_to_a_hex_string
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string
          cek(hashHex, token = "")
        }).catch(ex => console.error(ex));
      };
      reader.onerror = function (err) {
        console.error("Failed to read file", err);
      }
      reader.readAsArrayBuffer(fileInput.files[0]);
    }
    function cekttd(id, token) {
      $.get(url + `?page=cek&jenis=ttd&key=${id}&token="${token}"`, function (data, status) {
        if (typeof data.status == "undefined") {
          Swal.fire(
            "Tanda tangan valid",
            "",
            'success'
          )
          $("div#dttd").removeClass("hide");
          $("h1#ttdverif").html("<i class='bi bi-patch-check'></i><br>Terverifikasi");
          $("input#dokumen").val(data[0].Dokumen);
          $("input#signby").val(data[0].SginBy);
          $("input#untuk").val(data[0].Untuk);
        } else {
          $("h1#ttdverif").html("");
          Swal.fire(
            "Tanda tangan tidak valid",
            "",
            'error'
          )
        }
      });
    }

    function cek(hex, token) {
      $.get(url + `?page=cek&jenis=doc&key=${hex}&token=${token}`, function (data, status) {
        if (typeof data.status == "undefined") {
          Swal.fire(
            "Dokumen valid",
            "",
            'success'
          )
        } else {
          Swal.fire(
            "Dokumen tidak valid",
            "",
            'error'
          )
        }
      });
    }
    function isvalidURL(str) {
      var pattern = new RegExp('^(https?:\\/\\/)?' + // protocol
        '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // domain name
        '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR ip (v4) address
        '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // port and path
        '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string
        '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator
      return !!pattern.test(str);
    }
  </script>
</body>

</html>